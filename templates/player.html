{% extends "base.html" %}

{% block title %}Player - {{ media.original_name }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-9">
        <div class="card mb-4">
            <div class="card-body p-0">
                <video id="mediaPlayer" class="video-js vjs-default-skin vjs-big-play-centered" controls preload="auto" 
                       data-filename="{{ media.filename }}">
                    <source src="/stream/{{ media.filename }}" type="{{ media.mime_type }}">
                    
                    {% for subtitle in subtitles %}
                    <track kind="subtitles" src="/subtitles/{{ subtitle.filename }}" 
                           srclang="{{ subtitle.language }}" label="{{ subtitle.language }}">
                    {% endfor %}
                    
                    Your browser does not support the video tag.
                </video>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-info-circle"></i> Media Information</h5>
                <dl class="row mb-0">
                    <dt class="col-sm-3">File Name:</dt>
                    <dd class="col-sm-9">{{ media.original_name }}</dd>
                    
                    <dt class="col-sm-3">Type:</dt>
                    <dd class="col-sm-9">{{ media.file_type | capitalize }}</dd>
                    
                    <dt class="col-sm-3">Size:</dt>
                    <dd class="col-sm-9">{{ (media.file_size / 1024 / 1024) | round(2) }} MB</dd>
                    
                    <dt class="col-sm-3">Upload Date:</dt>
                    <dd class="col-sm-9">{{ media.upload_date }}</dd>
                    
                    <dt class="col-sm-3">Play Count:</dt>
                    <dd class="col-sm-9">{{ media.play_count }}</dd>
                    
                    <dt class="col-sm-3">Total Watch Time:</dt>
                    <dd class="col-sm-9">{{ (media.total_watch_time / 60) | round(2) }} minutes</dd>
                </dl>
            </div>
        </div>
    </div>

    <div class="col-lg-3">
        <div class="card mb-3">
            <div class="card-body">
                <h6 class="card-title"><i class="bi bi-sliders"></i> Playback Controls</h6>
                
                <div class="mb-3">
                    <label class="form-label small">Playback Speed</label>
                    <select class="form-select form-select-sm" id="speedControl">
                        <option value="0.25">0.25x</option>
                        <option value="0.5">0.5x</option>
                        <option value="0.75">0.75x</option>
                        <option value="1" selected>1x</option>
                        <option value="1.25">1.25x</option>
                        <option value="1.5">1.5x</option>
                        <option value="1.75">1.75x</option>
                        <option value="2">2x</option>
                    </select>
                </div>

                <div class="form-check form-switch mb-2">
                    <input class="form-check-input" type="checkbox" id="loopToggle">
                    <label class="form-check-label small" for="loopToggle">Loop playback</label>
                </div>

                <div class="form-check form-switch mb-2">
                    <input class="form-check-input" type="checkbox" id="autoplayToggle">
                    <label class="form-check-label small" for="autoplayToggle">Autoplay</label>
                </div>

                <button class="btn btn-sm btn-outline-primary w-100 mb-2" id="pipBtn">
                    <i class="bi bi-pip"></i> Picture-in-Picture
                </button>

                <button class="btn btn-sm btn-outline-secondary w-100" id="screenshotBtn">
                    <i class="bi bi-camera"></i> Take Screenshot
                </button>
            </div>
        </div>

        <div class="card mb-3">
            <div class="card-body">
                <h6 class="card-title"><i class="bi bi-badge-cc"></i> Subtitles</h6>
                
                {% if subtitles %}
                <div class="list-group list-group-flush mb-3">
                    {% for subtitle in subtitles %}
                    <div class="list-group-item small">
                        <i class="bi bi-file-text"></i> {{ subtitle.language }}
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted small">No subtitles available</p>
                {% endif %}

                <button class="btn btn-sm btn-primary w-100" data-bs-toggle="modal" data-bs-target="#subtitleModal">
                    <i class="bi bi-upload"></i> Upload Subtitle
                </button>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <h6 class="card-title"><i class="bi bi-bookmark"></i> Bookmarks</h6>
                <div id="bookmarksList" class="small"></div>
                <button class="btn btn-sm btn-outline-success w-100 mt-2" id="addBookmarkBtn">
                    <i class="bi bi-plus-circle"></i> Add Bookmark
                </button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="subtitleModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Upload Subtitle</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Subtitle File (.srt or .vtt)</label>
                    <input type="file" class="form-control" id="subtitleFile" accept=".srt,.vtt">
                </div>
                <div class="mb-3">
                    <label class="form-label">Language</label>
                    <input type="text" class="form-control" id="subtitleLang" placeholder="e.g., English, Spanish">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="uploadSubtitleBtn">Upload</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/player.js') }}"></script>
{% endblock %}
